<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PurchaseOrderBean.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Petstore application using Java EE 7</a> &gt; <a href="index.source.html" class="el_package">org.agoncal.application.petstore.view.admin</a> &gt; <span class="el_source">PurchaseOrderBean.java</span></div><h1>PurchaseOrderBean.java</h1><pre class="source lang-java linenums">package org.agoncal.application.petstore.view.admin;

import java.io.Serializable;
import java.util.ArrayList;
import java.util.List;

import javax.annotation.Resource;
import javax.ejb.SessionContext;
import javax.ejb.Stateful;
import javax.enterprise.context.Conversation;
import javax.enterprise.context.ConversationScoped;
import javax.faces.application.FacesMessage;
import javax.faces.component.UIComponent;
import javax.faces.context.FacesContext;
import javax.faces.convert.Converter;
import javax.inject.Inject;
import javax.inject.Named;
import javax.persistence.EntityManager;
import javax.persistence.PersistenceContext;
import javax.persistence.PersistenceContextType;
import javax.persistence.TypedQuery;
import javax.persistence.criteria.CriteriaBuilder;
import javax.persistence.criteria.CriteriaQuery;
import javax.persistence.criteria.Predicate;
import javax.persistence.criteria.Root;

import org.agoncal.application.petstore.model.PurchaseOrder;
import org.agoncal.application.petstore.util.Loggable;

/**
 * Backing bean for PurchaseOrder entities.
 * &lt;p/&gt;
 * This class provides CRUD functionality for all PurchaseOrder entities. It focuses
 * purely on Java EE 6 standards (e.g. &lt;tt&gt;&amp;#64;ConversationScoped&lt;/tt&gt; for state
 * management, &lt;tt&gt;PersistenceContext&lt;/tt&gt; for persistence, &lt;tt&gt;CriteriaBuilder&lt;/tt&gt; for
 * searches) rather than introducing a CRUD framework or custom base class.
 */

@Named
@Stateful
@ConversationScoped
@Loggable
<span class="nc" id="L43">public class PurchaseOrderBean implements Serializable {</span>

	private static final long serialVersionUID = 1L;

	/*
	 * Support creating and retrieving PurchaseOrder entities
	 */

	private Long id;

	public Long getId() {
<span class="nc" id="L54">		return this.id;</span>
	}

	public void setId(Long id) {
<span class="nc" id="L58">		this.id = id;</span>
<span class="nc" id="L59">	}</span>

	private PurchaseOrder purchaseOrder;

	public PurchaseOrder getPurchaseOrder() {
<span class="nc" id="L64">		return this.purchaseOrder;</span>
	}

	public void setPurchaseOrder(PurchaseOrder purchaseOrder) {
<span class="nc" id="L68">		this.purchaseOrder = purchaseOrder;</span>
<span class="nc" id="L69">	}</span>

	@Inject
	private Conversation conversation;

	@PersistenceContext(unitName = &quot;applicationPetstorePU&quot;, type = PersistenceContextType.EXTENDED)
	private EntityManager entityManager;

	public String create() {

<span class="nc" id="L79">		this.conversation.begin();</span>
<span class="nc" id="L80">		this.conversation.setTimeout(1800000L);</span>
<span class="nc" id="L81">		return &quot;create?faces-redirect=true&quot;;</span>
	}

	public void retrieve() {

<span class="nc bnc" id="L86" title="All 2 branches missed.">		if (FacesContext.getCurrentInstance().isPostback()) {</span>
<span class="nc" id="L87">			return;</span>
		}

<span class="nc bnc" id="L90" title="All 2 branches missed.">		if (this.conversation.isTransient()) {</span>
<span class="nc" id="L91">			this.conversation.begin();</span>
<span class="nc" id="L92">			this.conversation.setTimeout(1800000L);</span>
		}

<span class="nc bnc" id="L95" title="All 2 branches missed.">		if (this.id == null) {</span>
<span class="nc" id="L96">			this.purchaseOrder = this.example;</span>
		}
		else {
<span class="nc" id="L99">			this.purchaseOrder = findById(getId());</span>
		}
<span class="nc" id="L101">	}</span>

	public PurchaseOrder findById(Long id) {

<span class="nc" id="L105">		return this.entityManager.find(PurchaseOrder.class, id);</span>
	}

	/*
	 * Support updating and deleting PurchaseOrder entities
	 */

	public String update() {
<span class="nc" id="L113">		this.conversation.end();</span>

		try {
<span class="nc bnc" id="L116" title="All 2 branches missed.">			if (this.id == null) {</span>
<span class="nc" id="L117">				this.entityManager.persist(this.purchaseOrder);</span>
<span class="nc" id="L118">				return &quot;search?faces-redirect=true&quot;;</span>
			}
			else {
<span class="nc" id="L121">				this.entityManager.merge(this.purchaseOrder);</span>
<span class="nc" id="L122">				return &quot;view?faces-redirect=true&amp;id=&quot; + this.purchaseOrder.getId();</span>
			}
		}
<span class="nc" id="L125">		catch (Exception e) {</span>
<span class="nc" id="L126">			FacesContext.getCurrentInstance().addMessage(null, new FacesMessage(e.getMessage()));</span>
<span class="nc" id="L127">			return null;</span>
		}
	}

	public String delete() {
<span class="nc" id="L132">		this.conversation.end();</span>

		try {
<span class="nc" id="L135">			PurchaseOrder deletableEntity = findById(getId());</span>

<span class="nc" id="L137">			this.entityManager.remove(deletableEntity);</span>
<span class="nc" id="L138">			this.entityManager.flush();</span>
<span class="nc" id="L139">			return &quot;search?faces-redirect=true&quot;;</span>
		}
<span class="nc" id="L141">		catch (Exception e) {</span>
<span class="nc" id="L142">			FacesContext.getCurrentInstance().addMessage(null, new FacesMessage(e.getMessage()));</span>
<span class="nc" id="L143">			return null;</span>
		}
	}

	/*
	 * Support searching PurchaseOrder entities with pagination
	 */

	private int page;

	private long count;

	private List&lt;PurchaseOrder&gt; pageItems;

<span class="nc" id="L157">	private PurchaseOrder example = new PurchaseOrder();</span>

	public int getPage() {
<span class="nc" id="L160">		return this.page;</span>
	}

	public void setPage(int page) {
<span class="nc" id="L164">		this.page = page;</span>
<span class="nc" id="L165">	}</span>

	public int getPageSize() {
<span class="nc" id="L168">		return 10;</span>
	}

	public PurchaseOrder getExample() {
<span class="nc" id="L172">		return this.example;</span>
	}

	public void setExample(PurchaseOrder example) {
<span class="nc" id="L176">		this.example = example;</span>
<span class="nc" id="L177">	}</span>

	public String search() {
<span class="nc" id="L180">		this.page = 0;</span>
<span class="nc" id="L181">		return null;</span>
	}

	public void paginate() {

<span class="nc" id="L186">		CriteriaBuilder builder = this.entityManager.getCriteriaBuilder();</span>

		// Populate this.count

<span class="nc" id="L190">		CriteriaQuery&lt;Long&gt; countCriteria = builder.createQuery(Long.class);</span>
<span class="nc" id="L191">		Root&lt;PurchaseOrder&gt; root = countCriteria.from(PurchaseOrder.class);</span>
<span class="nc" id="L192">		countCriteria = countCriteria.select(builder.count(root)).where(getSearchPredicates(root));</span>
<span class="nc" id="L193">		this.count = this.entityManager.createQuery(countCriteria).getSingleResult();</span>

		// Populate this.pageItems

<span class="nc" id="L197">		CriteriaQuery&lt;PurchaseOrder&gt; criteria = builder.createQuery(PurchaseOrder.class);</span>
<span class="nc" id="L198">		root = criteria.from(PurchaseOrder.class);</span>
<span class="nc" id="L199">		TypedQuery&lt;PurchaseOrder&gt; query = this.entityManager</span>
<span class="nc" id="L200">			.createQuery(criteria.select(root).where(getSearchPredicates(root)));</span>
<span class="nc" id="L201">		query.setFirstResult(this.page * getPageSize()).setMaxResults(getPageSize());</span>
<span class="nc" id="L202">		this.pageItems = query.getResultList();</span>
<span class="nc" id="L203">	}</span>

	private Predicate[] getSearchPredicates(Root&lt;PurchaseOrder&gt; root) {

<span class="nc" id="L207">		CriteriaBuilder builder = this.entityManager.getCriteriaBuilder();</span>
<span class="nc" id="L208">		List&lt;Predicate&gt; predicatesList = new ArrayList&lt;Predicate&gt;();</span>

<span class="nc" id="L210">		String street1 = this.example.getDeliveryAddress().getStreet1();</span>
<span class="nc bnc" id="L211" title="All 4 branches missed.">		if (street1 != null &amp;&amp; !&quot;&quot;.equals(street1)) {</span>
<span class="nc" id="L212">			predicatesList</span>
<span class="nc" id="L213">				.add(builder.like(builder.lower(root.&lt;String&gt;get(&quot;street1&quot;)), '%' + street1.toLowerCase() + '%'));</span>
		}
<span class="nc" id="L215">		String street2 = this.example.getDeliveryAddress().getStreet2();</span>
<span class="nc bnc" id="L216" title="All 4 branches missed.">		if (street2 != null &amp;&amp; !&quot;&quot;.equals(street2)) {</span>
<span class="nc" id="L217">			predicatesList</span>
<span class="nc" id="L218">				.add(builder.like(builder.lower(root.&lt;String&gt;get(&quot;street2&quot;)), '%' + street2.toLowerCase() + '%'));</span>
		}
<span class="nc" id="L220">		String city = this.example.getDeliveryAddress().getCity();</span>
<span class="nc bnc" id="L221" title="All 4 branches missed.">		if (city != null &amp;&amp; !&quot;&quot;.equals(city)) {</span>
<span class="nc" id="L222">			predicatesList.add(builder.like(builder.lower(root.&lt;String&gt;get(&quot;city&quot;)), '%' + city.toLowerCase() + '%'));</span>
		}
<span class="nc" id="L224">		String state = this.example.getDeliveryAddress().getState();</span>
<span class="nc bnc" id="L225" title="All 4 branches missed.">		if (state != null &amp;&amp; !&quot;&quot;.equals(state)) {</span>
<span class="nc" id="L226">			predicatesList.add(builder.like(builder.lower(root.&lt;String&gt;get(&quot;state&quot;)), '%' + state.toLowerCase() + '%'));</span>
		}
<span class="nc" id="L228">		String zipcode = this.example.getDeliveryAddress().getZipcode();</span>
<span class="nc bnc" id="L229" title="All 4 branches missed.">		if (zipcode != null &amp;&amp; !&quot;&quot;.equals(zipcode)) {</span>
<span class="nc" id="L230">			predicatesList</span>
<span class="nc" id="L231">				.add(builder.like(builder.lower(root.&lt;String&gt;get(&quot;zipcode&quot;)), '%' + zipcode.toLowerCase() + '%'));</span>
		}

<span class="nc" id="L234">		return predicatesList.toArray(new Predicate[predicatesList.size()]);</span>
	}

	public List&lt;PurchaseOrder&gt; getPageItems() {
<span class="nc" id="L238">		return this.pageItems;</span>
	}

	public long getCount() {
<span class="nc" id="L242">		return this.count;</span>
	}

	/*
	 * Support listing and POSTing back PurchaseOrder entities (e.g. from inside an
	 * HtmlSelectOneMenu)
	 */

	public List&lt;PurchaseOrder&gt; getAll() {

<span class="nc" id="L252">		CriteriaQuery&lt;PurchaseOrder&gt; criteria = this.entityManager.getCriteriaBuilder()</span>
<span class="nc" id="L253">			.createQuery(PurchaseOrder.class);</span>
<span class="nc" id="L254">		return this.entityManager.createQuery(criteria.select(criteria.from(PurchaseOrder.class))).getResultList();</span>
	}

	@Resource
	private SessionContext sessionContext;

	public Converter getConverter() {

<span class="nc" id="L262">		final PurchaseOrderBean ejbProxy = this.sessionContext.getBusinessObject(PurchaseOrderBean.class);</span>

<span class="nc" id="L264">		return new Converter() {</span>

			@Override
			public Object getAsObject(FacesContext context, UIComponent component, String value) {

<span class="nc" id="L269">				return ejbProxy.findById(Long.valueOf(value));</span>
			}

			@Override
			public String getAsString(FacesContext context, UIComponent component, Object value) {

<span class="nc bnc" id="L275" title="All 2 branches missed.">				if (value == null) {</span>
<span class="nc" id="L276">					return &quot;&quot;;</span>
				}

<span class="nc" id="L279">				return String.valueOf(((PurchaseOrder) value).getId());</span>
			}
		};
	}

	/*
	 * Support adding children to bidirectional, one-to-many tables
	 */

<span class="nc" id="L288">	private PurchaseOrder add = new PurchaseOrder();</span>

	public PurchaseOrder getAdd() {
<span class="nc" id="L291">		return this.add;</span>
	}

	public PurchaseOrder getAdded() {
<span class="nc" id="L295">		PurchaseOrder added = this.add;</span>
<span class="nc" id="L296">		this.add = new PurchaseOrder();</span>
<span class="nc" id="L297">		return added;</span>
	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>